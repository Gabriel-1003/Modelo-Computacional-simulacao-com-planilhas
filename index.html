<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modelo Computacional - Simula√ß√£o com Planilhas</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="cyber-container shine-effect">
        <div class="cyber-header">
            <h1 class="glitch-effect" data-text="CompuModel">Modelo Computacional - Simulador de Planilhas</h1>
        </div>

        <div class="toolbar">
            <button class="cyber-button" id="btn-nova-planilha">
                <span class="btn-text">Nova Planilha</span>
                <span class="btn-icon">üìä</span>
            </button>
            <button class="cyber-button" id="btn-calcular">
                <span class="btn-text">Calcular Tudo</span>
                <span class="btn-icon">‚ö°</span>
            </button>
            <button class="cyber-button" id="btn-exportar">
                <span class="btn-text">Exportar Dados</span>
                <span class="btn-icon">üíæ</span>
            </button>
            <div class="search-box">
                <input type="text" placeholder="Buscar na planilha..." id="input-busca">
                <span class="search-icon">üîç</span>
            </div>
        </div>

        <div class="formula-bar">
            <span class="formula-label">F√≥rmula:</span>
            <input type="text" id="formula-input" placeholder="Digite a f√≥rmula (ex: =A1+B1)">
        </div>

        <div class="spreadsheet-container">
            <table class="spreadsheet" id="main-spreadsheet">
                <thead>
                    <tr>
                        <th class="corner-cell"></th>
                        <th>A</th>
                        <th>B</th>
                        <th>C</th>
                        <th>D</th>
                        <th>E</th>
                        <th>F</th>
                        <th>G</th>
                        <th>H</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>1</th>
                        <td contenteditable="true" data-cell="A1">100</td>
                        <td contenteditable="true" data-cell="B1">50</td>
                        <td contenteditable="true" data-cell="C1" data-formula="=A1+B1"></td>
                        <td contenteditable="true" data-cell="D1">Projeto Alpha</td>
                        <td contenteditable="true" data-cell="E1">2023-01-15</td>
                        <td contenteditable="true" data-cell="F1" data-formula="=C1*0.2"></td>
                        <td contenteditable="true" data-cell="G1">Ativo</td>
                        <td contenteditable="true" data-cell="H1" data-formula="=SE(G1='Ativo';C1;0)"></td>
                    </tr>
                    <tr>
                        <th>2</th>
                        <td contenteditable="true" data-cell="A2">200</td>
                        <td contenteditable="true" data-cell="B2">75</td>
                        <td contenteditable="true" data-cell="C2" data-formula="=A2-B2"></td>
                        <td contenteditable="true" data-cell="D2">Projeto Beta</td>
                        <td contenteditable="true" data-cell="E2">2023-02-20</td>
                        <td contenteditable="true" data-cell="F2" data-formula="=C2*0.15"></td>
                        <td contenteditable="true" data-cell="G2">Inativo</td>
                        <td contenteditable="true" data-cell="H2" data-formula="=SE(G2='Ativo';C2;0)"></td>
                    </tr>
                    <tr>
                        <th>3</th>
                        <td contenteditable="true" data-cell="A3">150</td>
                        <td contenteditable="true" data-cell="B3">30</td>
                        <td contenteditable="true" data-cell="C3" data-formula="=A3*B3"></td>
                        <td contenteditable="true" data-cell="D3">Projeto Gama</td>
                        <td contenteditable="true" data-cell="E3">2023-03-10</td>
                        <td contenteditable="true" data-cell="F3" data-formula="=C3*0.18"></td>
                        <td contenteditable="true" data-cell="G3">Ativo</td>
                        <td contenteditable="true" data-cell="H3" data-formula="=SE(G3='Ativo';C3;0)"></td>
                    </tr>
                    <tr>
                        <th>4</th>
                        <td contenteditable="true" data-cell="A4">300</td>
                        <td contenteditable="true" data-cell="B4">120</td>
                        <td contenteditable="true" data-cell="C4" data-formula="=A4/B4"></td>
                        <td contenteditable="true" data-cell="D4">Projeto Delta</td>
                        <td contenteditable="true" data-cell="E4">2023-04-05</td>
                        <td contenteditable="true" data-cell="F4" data-formula="=C4*0.22"></td>
                        <td contenteditable="true" data-cell="G4">Pendente</td>
                        <td contenteditable="true" data-cell="H4" data-formula="=SE(G4='Ativo';C4;0)"></td>
                    </tr>
                    <tr>
                        <th>5</th>
                        <td contenteditable="true" data-cell="A5">80</td>
                        <td contenteditable="true" data-cell="B5">40</td>
                        <td contenteditable="true" data-cell="C5" data-formula="=A5+B5"></td>
                        <td contenteditable="true" data-cell="D5">Projeto √âpsilon</td>
                        <td contenteditable="true" data-cell="E5">2023-05-12</td>
                        <td contenteditable="true" data-cell="F5" data-formula="=C5*0.1"></td>
                        <td contenteditable="true" data-cell="G5">Ativo</td>
                        <td contenteditable="true" data-cell="H5" data-formula="=SE(G5='Ativo';C5;0)"></td>
                    </tr>
                    <tr class="summary-row">
                        <th>TOTAIS</th>
                        <td data-cell="A6" data-formula="=SOMA(A1:A5)"></td>
                        <td data-cell="B6" data-formula="=SOMA(B1:B5)"></td>
                        <td data-cell="C6" data-formula="=SOMA(C1:C5)"></td>
                        <td>-</td>
                        <td>-</td>
                        <td data-cell="F6" data-formula="=SOMA(F1:F5)"></td>
                        <td>-</td>
                        <td data-cell="H6" data-formula="=SOMA(H1:H5)"></td>
                    </tr>
                    <tr class="summary-row">
                        <th>M√âDIAS</th>
                        <td data-cell="A7" data-formula="=M√âDIA(A1:A5)"></td>
                        <td data-cell="B7" data-formula="=M√âDIA(B1:B5)"></td>
                        <td data-cell="C7" data-formula="=M√âDIA(C1:C5)"></td>
                        <td>-</td>
                        <td>-</td>
                        <td data-cell="F7" data-formula="=M√âDIA(F1:F5)"></td>
                        <td>-</td>
                        <td data-cell="H7" data-formula="=M√âDIA(H1:H5)"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="cyber-footer">
            <div class="footer-info">
                <span class="info-item">C√©lulas com f√≥rmulas: <strong id="formula-count">8</strong></span>
                <span class="info-item">√öltimo c√°lculo: <strong id="last-calculation">-</strong></span>
                <span class="info-item">Status: <strong class="status-active" id="calc-status">Pronto</strong></span>
            </div>
            <div class="system-info">
                Modelo Computacional v1.0 | Sistema de Simula√ß√£o com Planilhas | <span id="current-date"></span>
            </div>
        </div>
    </div>

    <script>
        // Atualiza a data atual
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('pt-BR');
        
        // Adiciona efeito de clique nas c√©lulas
        document.querySelectorAll('.spreadsheet td[contenteditable="true"]').forEach(cell => {
            cell.addEventListener('click', (e) => {
                // Limpa sele√ß√µes anteriores
                document.querySelectorAll('.spreadsheet td.selected').forEach(selected => {
                    selected.classList.remove('selected');
                });
                
                // Seleciona a c√©lula atual
                e.target.classList.add('selected');
                
                // Atualiza a barra de f√≥rmula
                const formulaInput = document.getElementById('formula-input');
                const formula = e.target.getAttribute('data-formula') || '';
                formulaInput.value = formula ? formula : '';
                formulaInput.focus();
                
                // Se a c√©lula tem f√≥rmula, mostra na barra
                if (formula) {
                    formulaInput.value = formula;
                }
            });
            
            cell.addEventListener('blur', (e) => {
                // Atualiza a c√©lula se houver uma f√≥rmula na barra
                const formulaInput = document.getElementById('formula-input');
                if (formulaInput.value.startsWith('=')) {
                    e.target.setAttribute('data-formula', formulaInput.value);
                    calcularFormula(e.target);
                }
            });
        });
        
        // Bot√£o de calcular tudo
        document.getElementById('btn-calcular').addEventListener('click', () => {
            calcularTudo();
        });
        
        // Fun√ß√£o para calcular uma f√≥rmula espec√≠fica
        function calcularFormula(cell) {
            const formula = cell.getAttribute('data-formula');
            if (!formula || !formula.startsWith('=')) return;
            
            try {
                const resultado = interpretarFormula(formula, cell.getAttribute('data-cell'));
                cell.textContent = resultado;
                cell.classList.add('calculated');
                
                // Atualiza o √∫ltimo c√°lculo
                document.getElementById('last-calculation').textContent = new Date().toLocaleTimeString('pt-BR');
            } catch (error) {
                cell.textContent = '#ERRO!';
                cell.classList.add('error');
            }
        }
        
        // Fun√ß√£o para calcular todas as f√≥rmulas
        function calcularTudo() {
            document.getElementById('calc-status').textContent = 'Calculando...';
            
            setTimeout(() => {
                const formulaCells = document.querySelectorAll('[data-formula]');
                formulaCells.forEach(cell => {
                    calcularFormula(cell);
                });
                
                document.getElementById('calc-status').textContent = 'Pronto';
                document.getElementById('formula-count').textContent = formulaCells.length;
            }, 500);
        }
        
        // Interpretador b√°sico de f√≥rmulas
        function interpretarFormula(formula, cellRef) {
            // Remove o sinal de igual
            let expr = formula.substring(1);
            
            // Substitui refer√™ncias de c√©lulas por seus valores
            expr = expr.replace(/[A-Z]+\d+/g, (match) => {
                const refCell = document.querySelector(`[data-cell="${match}"]`);
                return refCell ? parseFloat(refCell.textContent) || 0 : 0;
            });
            
            // Converte fun√ß√µes em portugu√™s para ingl√™s para eval
            expr = expr.replace(/SOMA/gi, 'sum')
                      .replace(/M√âDIA/gi, 'avg')
                      .replace(/SE/gi, 'if');
            
            // Fun√ß√µes personalizadas
            const sum = (...args) => args.reduce((a, b) => a + b, 0);
            const avg = (...args) => args.reduce((a, b) => a + b, 0) / args.length;
            const if = (condition, trueValue, falseValue) => condition ? trueValue : falseValue;
            
            // Avalia a express√£o
            return eval(expr);
        }
        
        // Calcula tudo ao carregar a p√°gina
        window.addEventListener('load', () => {
            setTimeout(calcularTudo, 1000);
        });
    </script>
</body>
</html>